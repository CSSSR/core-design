## Содержимое репозитория
Это монорепозиторий, в котором включены [yarn workspaces](https://yarnpkg.com/en/docs/workspaces), поэтому каждая директория в `./packages/*` представляет из себя отдельный пакет.

Все зависимости устанавливаются в общую папку `node_modules` (в корневой директории), а внутренние пакеты линкуются между собой.

Сейчас репозиторий содержит 3 пакета:
* `@asmy/core-design` — основной пакет, библиотека с переиспользуемыми React-компонентами;
* `@asmy/core-docs` — документация, приложение на Next.js, использует компоненты из `@asmy/core-design`;
* `@asmy/core-scripts` — cli-утилита для развертывания голого проекта from scratch из файлов-шаблонов и других полезных комманд, которые могут приготиться пользователю библиотеки;

Пакеты `@asmy/core-design` и `@asmy/core-scripts` публикуются в npm.

## Как разрабатывать
В большинстве случаев нужно:
1. Запустить npm-cкрипт `$ yarn run dev` в директирии `./packages/core-design`;
2. Запустить dev-сервер приложения документации `$ yarn run dev` в директирии `./packages/core-docs`;

## Пакет `@asmy/core-design`
Эту библиотеку подключают в проект (с React-ом), и импортируют из неё компоненты.

### Выжные поля в package.json
Стоит обратить внимание, что в поле `main` указан файл `lib/index.js`. Следовательно, при импорте библиотеки этот файл считается входной точкой.

В `package.json` также можно увидеть все необходимые для сборки npm-скрипты.

### Зависимости

Ожидается, что у проекта, где будет использоваться библиотека, уже установлены следующие зависимости:
* [@emotion/core](https://www.npmjs.com/package/@emotion/core)
* [@emotion/styled](https://www.npmjs.com/package/@emotion/styled)
* [react](https://www.npmjs.com/package/react)
* [react-dom](https://www.npmjs.com/package/react-dom)

Эти зависимости прописаны в `peerDependencies` в `package.json` файле пакета `@asmy/core-design`. Использование библиотеки `@asmy/core-design` без этих пакетов невозможно.

Также стоит отметить, что эти зависимости есть в `devDependencies` — сейчас это нужно для корректного работы системы типов, в будущем это будет нужно для unit-тестов.

### Сборка для продакшн
При вызове npm-скрипта `build` сначала производится очистка директории `packages/core-design/lib`, куда в дальнейшем попадут артифакты сборки.

Далее запускается 3 парраллельных процесса:
1. Производится транспиляция babel-ем, который, используя конфигурацию из файла `packages/core-design/babel.config.js`, транспилирует `.tsx` и `.ts` файлы и складывает результат в директорию `packages/core-design/lib`;
2. Утилита `tsc` (транспайлер TypeScript-a) складывает в ту же директорию файлы-декларации типов;
3. Утилита `cpx` копирует в ту же конечную директорию файлы картинок и шрифтов (работает по glob-паттерну);

### Сборка для локальной разработки
Производится аналогично сборке для продакшн, только все параллельные процессы запускаются в `watch` режиме.

## Пакет `@asmy/core-scripts`
Представляет из себя простую cli-утилиту, написанную с использованием [yargs](https://github.com/yargs/yargs).

При установке глобально (`npm install -g @asmy/core-scripts`) пользователю устанавливается cli-утилита, которую можно вызвать так:
```
$ core-design --help
```

### Сборка для продашкн
Нет как таковой, т.к. утилита пишется на JS-е, без использования особого (современного) синтаксиса, нет транспиляции кода.

### Сборка для локальной разработки
Для локальной разработки требуется иметь возможность часто запускать cli-утилиту после внесения правок в код. Для этого удобно сделать так:
1. Перейти в директорию пакета `$ cd ./packages/core-scripts`;
2. Выполнить команду `$ npm link`;

Теперь можно локально запускать команду `$ core-design ...`.

## Пакет `@asmy/core-docs`
Это приложение c SSR (на Next.js), которое использует компоненты из библиотеки `@asmy/core-design` для построения документации на неё же.

### Сборка для продашкн
Можно посмотреть в документации Next.js. Если вкратце: происходит запуск npm-скрипта `build`, а после этого `start`. Артифакты сборки попадают в директорию `./packages/core-docs/.next`. Используется конфигурация из файла `./packages/core-docs/next.config.js`

### Сборка для локальной разработки
Запускается скрипт `dev`. Используется конфигурация из файла `./packages/core-docs/next.config.js`, где есть несколько важных особенностей:
1. Добавлен костыль, который добавляет корректную настройку [externals](https://webpack.js.org/configuration/externals/) webpack-конфига SSR-части для пакета `@asmy/core-design`; Это сделано для корректного отслеживания измененных файлов библиотеки, корректной работы HMR;
2. Добавлен плагин для проверки типов;
